@if (jig()) {
  <div class="max-w-7xl mx-auto space-y-4 md:space-y-6 px-2 md:px-0">
    <!-- Header Card -->
    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md border-l-4" [class]="getStatusClass(jig().status)">
      <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
        <div class="flex-1">
          <h2 class="text-2xl md:text-3xl font-bold text-gray-800">{{ jig().id }}</h2>
          <p class="text-base md:text-lg text-gray-600">{{ jig().productModelType }}</p>
        </div>
        <div class="flex items-center gap-2 md:gap-4 w-full sm:w-auto">
          @if (jig().status !== 'Scrapped') {
             <button (click)="logMaintenance.emit(jig())" class="flex-1 sm:flex-none bg-yellow-500 text-white px-3 md:px-4 py-2 rounded-md hover:bg-yellow-600 transition-colors duration-200 shadow text-sm md:text-base">
                <i class="fas fa-tools mr-1 md:mr-2"></i><span class="hidden sm:inline">{{ 'detail.logMaintenance' | translate }}</span><span class="sm:hidden">{{ 'detail.logMaintenance' | translate }}</span>
             </button>
          }
          <button (click)="close.emit()" class="text-gray-500 hover:text-gray-800">
             <i class="fas fa-times-circle fa-2x"></i>
          </button>
        </div>
      </div>
      <div class="mt-4 pt-4 border-t">
        <span class="px-4 py-2 text-sm font-semibold rounded-full" [class]="getStatusClass(jig().status)">
          {{ 'detail.statusLabel' | translate }}: {{ getStatusTranslationKey(jig().status) | translate }}
        </span>
      </div>
    </div>

     <!-- Status Actions -->
    @if (jig().status !== 'Scrapped') {
      <div class="bg-white p-4 md:p-5 rounded-lg shadow">
        <h4 class="font-semibold text-gray-500 uppercase text-xs md:text-sm mb-3">{{ 'detail.action.title' | translate }}</h4>
        <div class="grid grid-cols-2 sm:flex sm:flex-wrap gap-2 md:gap-3">
          @if (jig().status !== 'In Stock') {
            <button (click)="onChangeStatus('In Stock')" class="bg-green-500 text-white px-3 md:px-4 py-2 rounded-md hover:bg-green-600 transition-colors duration-200 shadow-sm text-xs md:text-sm">
                <i class="fas fa-check-circle mr-1 md:mr-2"></i><span class="hidden sm:inline">{{ 'detail.action.setInStock' | translate }}</span><span class="sm:hidden">Stock</span>
            </button>
          }
          @if (jig().status !== 'In Use') {
            <button (click)="onChangeStatus('In Use')" class="bg-blue-500 text-white px-3 md:px-4 py-2 rounded-md hover:bg-blue-600 transition-colors duration-200 shadow-sm text-xs md:text-sm">
                <i class="fas fa-cogs mr-1 md:mr-2"></i><span class="hidden sm:inline">{{ 'detail.action.setInUse' | translate }}</span><span class="sm:hidden">In Use</span>
            </button>
          }
          @if (jig().status !== 'Under Maintenance') {
            <button (click)="onChangeStatus('Under Maintenance')" class="bg-yellow-500 text-white px-3 md:px-4 py-2 rounded-md hover:bg-yellow-600 transition-colors duration-200 shadow-sm text-xs md:text-sm">
                 <i class="fas fa-tools mr-1 md:mr-2"></i><span class="hidden sm:inline">{{ 'detail.action.setUnderMaintenance' | translate }}</span><span class="sm:hidden">Maint.</span>
            </button>
          }
           @if (jig().status !== 'Scrapped') {
            <button (click)="onChangeStatus('Scrapped')" class="bg-red-600 text-white px-3 md:px-4 py-2 rounded-md hover:bg-red-700 transition-colors duration-200 shadow-sm text-xs md:text-sm">
                 <i class="fas fa-trash-alt mr-1 md:mr-2"></i><span class="hidden sm:inline">{{ 'detail.action.setScrapped' | translate }}</span><span class="sm:hidden">Scrap</span>
            </button>
          }
        </div>
      </div>
    }

    <!-- Details Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="bg-white p-5 rounded-lg shadow">
            <h4 class="font-semibold text-gray-500 uppercase text-sm mb-2">{{ 'detail.customer' | translate }}</h4>
            <p class="text-lg text-gray-800">{{ jig().customer }}</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow">
            <h4 class="font-semibold text-gray-500 uppercase text-sm mb-2">{{ 'detail.responsiblePerson' | translate }}</h4>
            <p class="text-lg text-gray-800">{{ jig().responsiblePerson }}</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow">
            <h4 class="font-semibold text-gray-500 uppercase text-sm mb-2">{{ 'detail.storageLocation' | translate }}</h4>
            <p class="text-lg text-gray-800">{{ jig().storageLocation }}</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow">
            <h4 class="font-semibold text-gray-500 uppercase text-sm mb-2">{{ 'detail.dateReceived' | translate }}</h4>
            <p class="text-lg text-gray-800">{{ jig().dateOfReceive | date: 'longDate' }}</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow">
            <h4 class="font-semibold text-gray-500 uppercase text-sm mb-2">{{ 'detail.receivedFrom' | translate }}</h4>
            <p class="text-lg text-gray-800">{{ jig().receivedFrom }}</p>
        </div>
    </div>

    <!-- Notes Section -->
    @if (jig().notes) {
      <div class="bg-white p-5 rounded-lg shadow">
        <h4 class="font-semibold text-gray-500 uppercase text-sm mb-2">{{ 'detail.notes' | translate }}</h4>
        <p class="text-lg text-gray-800 whitespace-pre-wrap">{{ jig().notes }}</p>
      </div>
    }

    <!-- History Tabs -->
    <div class="bg-white rounded-lg shadow-md">
       <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-6 px-6">
          <button (click)="activeTab.set('maintenance')" 
                  class="py-4 px-1 border-b-2 font-medium text-sm"
                  [class]="activeTab() === 'maintenance' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
            {{ 'detail.maintenanceHistoryTab' | translate }}
          </button>
          <button (click)="activeTab.set('transfer')" 
                  class="py-4 px-1 border-b-2 font-medium text-sm"
                  [class]="activeTab() === 'transfer' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
            {{ 'detail.transferHistoryTab' | translate }}
          </button>
        </nav>
      </div>
      <div class="p-6">
        @if (activeTab() === 'maintenance') {
          <div class="flow-root">
             @if (jig().maintenanceHistory.length > 0) {
              <ul role="list" class="-mb-8">
                @for (item of jig().maintenanceHistory; track $index) {
                  <li>
                    <div class="relative pb-8">
                       @if(!$last) {
                        <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                       }
                      <div class="relative flex space-x-3 items-start">
                        <div>
                          <span class="h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white" [class]="item.checkResult === 'OK' ? 'bg-green-500' : 'bg-red-500'">
                            <i class="fas" [class]="item.checkResult === 'OK' ? 'fa-check' : 'fa-times'" class="text-white"></i>
                          </span>
                        </div>
                        <div class="min-w-0 flex-1 pt-1.5">
                          <p class="text-sm text-gray-500">{{ item.date | date: 'full' }} {{ 'detail.maintenance.by' | translate }} <span class="font-medium text-gray-900">{{ item.performedBy }}</span></p>
                          @if (item.issue) {
                            <p class="mt-1 text-sm text-gray-800"><span class="font-semibold">{{ 'detail.maintenance.issue' | translate }}:</span> {{ item.issue }}</p>
                          }
                          @if(item.correctiveAction) {
                            <p class="mt-1 text-sm text-gray-800"><span class="font-semibold">{{ 'detail.maintenance.action' | translate }}:</span> {{ item.correctiveAction }}</p>
                          }
                           @if(item.notes) {
                            <p class="mt-1 text-sm text-gray-600 italic">"{{ item.notes }}"</p>
                          }
                        </div>
                      </div>
                    </div>
                  </li>
                }
              </ul>
            } @else {
              <p class="text-center text-gray-500 py-4">{{ 'detail.maintenance.empty' | translate }}</p>
            }
          </div>
        } @else {
          <div class="flow-root">
             @if (jig().transferHistory.length > 0) {
              <ul role="list" class="-mb-8">
                @for (item of jig().transferHistory; track $index) {
                  <li>
                    <div class="relative pb-8">
                       @if(!$last) {
                        <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                       }
                      <div class="relative flex space-x-3 items-start">
                        <div>
                           <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                            <i class="fas fa-exchange-alt text-white"></i>
                          </span>
                        </div>
                        <div class="min-w-0 flex-1 pt-1.5">
                           <p class="text-sm text-gray-500">{{ item.date | date: 'full' }}</p>
                           <p class="text-sm text-gray-800"><span class="font-medium">{{ item.type === 'Acceptance' ? ('detail.transfer.acceptance' | translate) : ('detail.transfer.submission' | translate) }}</span> {{ 'detail.transfer.from' | translate }} <span class="font-medium">{{ item.from }}</span> {{ 'detail.transfer.to' | translate }} <span class="font-medium">{{ item.to }}</span>. {{ 'detail.transfer.recipient' | translate }}: <span class="font-medium">{{ item.recipient }}</span>.</p>
                        </div>
                      </div>
                    </div>
                  </li>
                }
              </ul>
            } @else {
              <p class="text-center text-gray-500 py-4">{{ 'detail.transfer.empty' | translate }}</p>
            }
          </div>
        }
      </div>
    </div>
  </div>
}
