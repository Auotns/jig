@if (isAuthenticated()) {
<div class="flex h-screen bg-gray-50 text-gray-800 overflow-hidden">
  <!-- Mobile Menu Button -->
  <button (click)="isSidebarOpen.set(!isSidebarOpen())" class="fixed top-4 left-4 z-50 md:hidden bg-gray-800 text-white p-2 rounded-md shadow-lg">
    <i class="fas" [class.fa-bars]="!isSidebarOpen()" [class.fa-times]="isSidebarOpen()"></i>
  </button>

  <!-- Sidebar -->
  <aside class="w-64 flex-shrink-0 bg-gray-800 text-white flex flex-col transition-all duration-300 fixed md:static h-full z-40 md:z-auto"
         [ngClass]="{
           '-translate-x-full md:translate-x-0': !isSidebarOpen(),
           'translate-x-0': isSidebarOpen()
         }">
    <div class="h-20 flex items-center justify-center bg-gray-900">
      <h1 class="text-xl md:text-2xl font-bold tracking-wider">
        <i class="fas fa-toolbox mr-2 md:mr-3"></i>{{ 'sidebar.title' | translate }}
      </h1>
    </div>
    <nav class="flex-grow px-4 py-6 overflow-y-auto">
      <button (click)="currentView.set('inventory'); isSidebarOpen.set(false)"
        class="w-full flex items-center px-4 py-3 mt-4 rounded-lg transition-colors duration-200"
        [class]="currentView() === 'inventory' ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'">
        <i class="fas fa-clipboard-list w-6 text-center"></i>
        <span class="mx-4 font-medium">{{ 'sidebar.inventory' | translate }}</span>
      </button>
      <button (click)="handleNewJig(); isSidebarOpen.set(false)"
        class="w-full flex items-center px-4 py-3 mt-4 rounded-lg transition-colors duration-200"
        [class]="currentView() === 'newJig' ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'">
        <i class="fas fa-plus-circle w-6 text-center"></i>
        <span class="mx-4 font-medium">{{ 'sidebar.newJigRequest' | translate }}</span>
      </button>
    </nav>
    <div class="p-4 border-t border-gray-700">
        <p class="text-xs text-gray-400">{{ 'footer.copyright' | translate }}</p>
    </div>
  </aside>

  <!-- Sidebar Overlay for Mobile -->
  @if (isSidebarOpen()) {
    <div class="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden" (click)="isSidebarOpen.set(false)"></div>
  }

  <!-- Main content -->
  <main class="flex-1 flex flex-col overflow-hidden w-full">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 p-2 sm:p-4 md:p-6 flex-shrink-0">
      <div class="flex flex-col gap-2 sm:gap-4">
        <!-- Title Row -->
        <div class="flex items-center justify-between gap-2">
          <h2 class="text-xl sm:text-2xl md:text-3xl font-semibold text-gray-700 truncate">
            @switch (currentView()) {
              @case ('inventory') { {{ 'header.dashboard' | translate }} }
              @case ('detail') { {{ 'header.jigDetails' | translate }} }
              @case ('newJig') { {{ 'header.newJigRegistration' | translate }} }
              @case ('maintenance') { {{ 'header.logMaintenance' | translate }} }
            }
          </h2>
          
          <!-- User/Lang Controls -->
          <div class="flex items-center gap-1 sm:gap-3">
            <!-- User Info -->
            <div class="text-right hidden sm:block">
                <p class="font-semibold text-gray-800 text-xs sm:text-sm truncate">{{ currentUser()?.username }}</p>
                <p class="text-xs text-gray-500 truncate">{{ 'user.role.' + currentUser()?.role | translate }}</p>
            </div>

            <!-- Language Selector -->
            <div class="relative" #langDropdown>
                  <button (click)="isLangDropdownOpen.set(!isLangDropdownOpen())" class="flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 bg-gray-200 rounded-full hover:bg-gray-300 text-xs sm:text-sm font-semibold text-gray-700">
                      {{ translationService.language() | uppercase }}
                  </button>
                  @if(isLangDropdownOpen()) {
                      <div class="absolute right-0 mt-2 w-24 sm:w-32 bg-white rounded-md shadow-lg py-1 z-20 text-xs sm:text-sm">
                          <a (click)="setLanguage('en')" class="block px-3 sm:px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">English</a>
                          <a (click)="setLanguage('sk')" class="block px-3 sm:px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">SK</a>
                          <a (click)="setLanguage('de')" class="block px-3 sm:px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">DE</a>
                      </div>
                  }
              </div>

              <!-- Logout Button -->
              <button (click)="handleLogout()" title="{{ 'auth.logout' | translate }}" class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center bg-red-100 text-red-600 rounded-full hover:bg-red-200 hover:text-red-800 text-xs sm:text-sm">
                  <i class="fas fa-sign-out-alt"></i>
              </button>
          </div>
        </div>
        
        <!-- Filters Row (only on inventory view) -->
        @if(currentView() === 'inventory') {
          <!-- Admin Actions (Mobile: Single Row, Desktop: Separate) -->
          @if (currentUser()?.role === 'Administrator') {
            <div class="flex flex-wrap gap-2 mb-4">
              <button (click)="handleExportPdf()" class="px-3 py-2 text-xs sm:text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">
                <i class="fas fa-file-pdf mr-1 hidden sm:inline"></i>PDF
              </button>
              <button (click)="handleExportExcel()" class="px-3 py-2 text-xs sm:text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700">
                <i class="fas fa-file-excel mr-1 hidden sm:inline"></i>Excel
              </button>
              <button (click)="handleExportData()" class="px-3 py-2 text-xs sm:text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                <i class="fas fa-download mr-1 hidden sm:inline"></i>Export
              </button>
              <button (click)="triggerImport()" class="px-3 py-2 text-xs sm:text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                <i class="fas fa-upload mr-1 hidden sm:inline"></i>Import
              </button>
              <input type="file" #fileInput hidden (change)="handleImportData($event)" accept=".json">
            </div>
          }
          
          <!-- Filters Grid (Mobile: 1 col, Tablet: 2 cols, Desktop: 3 cols) -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            <!-- Customer Filter -->
            <div>
                <label for="customerFilter" class="block text-xs font-medium text-gray-700 mb-1">{{ 'filter.customerLabel' | translate }}</label>
                <select id="customerFilter" (change)="onCustomerFilterChange($event)" class="block w-full px-2 py-2 text-xs border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" [selected]="customerFilter() === ''">{{ 'filter.allCustomers' | translate }}</option>
                    @for(customer of uniqueCustomers(); track customer) {
                        <option [value]="customer" [selected]="customerFilter() === customer">{{ customer }}</option>
                    }
                </select>
            </div>
            
            <!-- Status Filter -->
            <div>
                <label for="statusFilter" class="block text-xs font-medium text-gray-700 mb-1">{{ 'filter.statusLabel' | translate }}</label>
                <select id="statusFilter" (change)="onStatusFilterChange($event)" class="block w-full px-2 py-2 text-xs border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" [selected]="statusFilter() === ''">{{ 'filter.allStatuses' | translate }}</option>
                    @for(status of jigStatuses; track status) {
                        <option [value]="status" [selected]="statusFilter() === status">{{ getStatusTranslationKey(status) | translate }}</option>
                    }
                </select>
            </div>
            
            <!-- Search Input -->
            <div>
                <label for="search" class="block text-xs font-medium text-gray-700 mb-1">{{ 'filter.searchLabel' | translate }}</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-2">
                        <i class="fas fa-search text-gray-400 text-xs"></i>
                    </span>
                    <input
                        id="search"
                        type="text"
                        [value]="filter()"
                        (input)="onFilterChange($event)"
                        class="w-full pl-8 pr-3 py-2 text-xs border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                        [placeholder]="'header.searchPlaceholder' | translate"
                    />
                </div>
            </div>
          </div>
        }
      </div>
    </header>

    <!-- Content area -->
    <div class="flex-1 overflow-y-auto bg-gray-50">
      <div class="p-2 sm:p-4 md:p-6">
        @switch (currentView()) {
          @case ('inventory') {
            <app-jig-inventory 
              [jigs]="jigs()" 
              [userRole]="currentUser()?.role"
              (viewJig)="handleViewJig($event)"
              (deleteJig)="handleDeleteJig($event)">
            </app-jig-inventory>
          }
          @case ('detail') {
            @if (selectedJig()) {
              <app-jig-detail 
                  [jig]="selectedJig()!" 
                  (logMaintenance)="handleLogMaintenance($event)" 
                  (changeStatus)="handleChangeStatus($event)"
                  (close)="currentView.set('inventory')">
              </app-jig-detail>
            }
          }
          @case ('newJig') {
            <app-jig-form (save)="handleSaveJig($event)" (cancel)="handleCancel()"></app-jig-form>
          }
          @case ('maintenance') {
            @if (selectedJig()) {
              <app-maintenance-form [jig]="selectedJig()!" (save)="handleSaveMaintenance($event)" (cancel)="handleCancel()"></app-maintenance-form>
            }
          }
        }
      </div>
    </div>
  </main>
</div>
} @else {
  <app-login></app-login>
}