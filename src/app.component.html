@if (isAuthenticated()) {
<div class="flex h-screen bg-gray-50 text-gray-800 overflow-hidden">
  <!-- Mobile Menu Button -->
  <button (click)="isSidebarOpen.set(!isSidebarOpen())" class="fixed top-4 left-4 z-50 md:hidden bg-gray-800 text-white p-2 rounded-md shadow-lg">
    <i class="fas" [class.fa-bars]="!isSidebarOpen()" [class.fa-times]="isSidebarOpen()"></i>
  </button>

  <!-- Sidebar -->
  <aside class="w-64 flex-shrink-0 bg-gray-800 text-white flex flex-col transition-transform duration-300 fixed md:static h-full z-40"
         [ngClass]="{
           '-translate-x-full': !isSidebarOpen(),
           'translate-x-0': isSidebarOpen()
         }"
         class="md:translate-x-0">
    <div class="h-20 flex items-center justify-center bg-gray-900">
      <h1 class="text-xl md:text-2xl font-bold tracking-wider">
        <i class="fas fa-toolbox mr-2 md:mr-3"></i>{{ 'sidebar.title' | translate }}
      </h1>
    </div>
    <nav class="flex-grow px-4 py-6 overflow-y-auto">
      <a (click)="currentView.set('inventory'); isSidebarOpen.set(false)"
        class="flex items-center px-4 py-3 mt-4 rounded-lg cursor-pointer transition-colors duration-200"
        [class]="currentView() === 'inventory' ? 'bg-blue-600 text-white' : 'hover:bg-gray-700 hover:text-white'">
        <i class="fas fa-clipboard-list w-6 text-center"></i>
        <span class="mx-4 font-medium">{{ 'sidebar.inventory' | translate }}</span>
      </a>
      <a (click)="handleNewJig(); isSidebarOpen.set(false)"
        class="flex items-center px-4 py-3 mt-4 rounded-lg cursor-pointer transition-colors duration-200"
        [class]="currentView() === 'newJig' ? 'bg-blue-600 text-white' : 'hover:bg-gray-700 hover:text-white'">
        <i class="fas fa-plus-circle w-6 text-center"></i>
        <span class="mx-4 font-medium">{{ 'sidebar.newJigRequest' | translate }}</span>
      </a>
    </nav>
    <div class="p-4 border-t border-gray-700">
        <p class="text-xs text-gray-400">{{ 'footer.copyright' | translate }}</p>
    </div>
  </aside>

  <!-- Sidebar Overlay for Mobile -->
  @if (isSidebarOpen()) {
    <div class="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden" (click)="isSidebarOpen.set(false)"></div>
  }

  <!-- Main content -->
  <main class="flex-1 flex flex-col overflow-hidden w-full">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 p-4 md:p-6 flex-shrink-0">
      <div class="flex flex-col gap-4">
        <!-- Title Row -->
        <div class="flex items-center justify-between">
          <h2 class="text-2xl md:text-3xl font-semibold text-gray-700">
            @switch (currentView()) {
              @case ('inventory') { {{ 'header.dashboard' | translate }} }
              @case ('detail') { {{ 'header.jigDetails' | translate }} }
              @case ('newJig') { {{ 'header.newJigRegistration' | translate }} }
              @case ('maintenance') { {{ 'header.logMaintenance' | translate }} }
            }
          </h2>
          
          <!-- User/Lang Controls -->
          <div class="flex items-center gap-2 sm:gap-4">
            <!-- User Info -->
            <div class="text-right hidden md:block">
                <p class="font-semibold text-gray-800 text-sm">{{ currentUser()?.username }}</p>
                <p class="text-xs text-gray-500">{{ 'user.role.' + currentUser()?.role | translate }}</p>
            </div>

            <!-- Language Selector -->
            <div class="relative" #langDropdown>
                  <button (click)="isLangDropdownOpen.set(!isLangDropdownOpen())" class="flex items-center justify-center w-10 h-10 bg-gray-200 rounded-full hover:bg-gray-300 focus:outline-none">
                      <span class="font-semibold text-gray-700">{{ translationService.language() | uppercase }}</span>
                  </button>
                  @if(isLangDropdownOpen()) {
                      <div class="absolute right-0 mt-2 w-32 bg-white rounded-md shadow-lg py-1 z-20">
                          <a (click)="setLanguage('en')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer">English</a>
                          <a (click)="setLanguage('sk')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer">Slovensky</a>
                          <a (click)="setLanguage('de')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer">Deutsch</a>
                      </div>
                  }
              </div>

              <!-- Logout Button -->
              <button (click)="handleLogout()" title="{{ 'auth.logout' | translate }}" class="w-10 h-10 flex items-center justify-center bg-red-100 text-red-600 rounded-full hover:bg-red-200 hover:text-red-800 transition-colors">
                  <i class="fas fa-sign-out-alt"></i>
              </button>
          </div>
        </div>
        
        <!-- Filters Row (only on inventory view) -->
        @if(currentView() === 'inventory') {
          <div class="flex flex-col lg:flex-row gap-3 lg:gap-4 items-stretch lg:items-end">
            <!-- Admin Actions -->
            @if (currentUser()?.role === 'Administrator') {
              <div class="flex flex-col sm:flex-row gap-2">
                <button (click)="handleExportPdf()" class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                  <i class="fas fa-file-pdf mr-2"></i>{{'header.actions.exportPdf' | translate}}
                </button>
                <button (click)="handleExportExcel()" class="px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                  <i class="fas fa-file-excel mr-2"></i>{{'header.actions.exportExcel' | translate}}
                </button>
                <button (click)="handleExportData()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  <i class="fas fa-file-export mr-2"></i>{{'header.actions.export' | translate}}
                </button>
                <button (click)="triggerImport()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                   <i class="fas fa-file-import mr-2"></i>{{'header.actions.import' | translate}}
                </button>
                <input type="file" #fileInput hidden (change)="handleImportData($event)" accept=".json">
              </div>
            }
            
            <!-- Customer Filter -->
            <div class="flex-1 min-w-[150px]">
                <label for="customerFilter" class="block text-sm font-medium text-gray-700 mb-1">{{ 'filter.customerLabel' | translate }}</label>
                <select id="customerFilter" (change)="onCustomerFilterChange($event)" class="block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-white">
                    <option value="" [selected]="customerFilter() === ''">{{ 'filter.allCustomers' | translate }}</option>
                    @for(customer of uniqueCustomers(); track customer) {
                        <option [value]="customer" [selected]="customerFilter() === customer">{{ customer }}</option>
                    }
                </select>
            </div>
            
            <!-- Status Filter -->
            <div class="flex-1 min-w-[150px]">
                <label for="statusFilter" class="block text-sm font-medium text-gray-700 mb-1">{{ 'filter.statusLabel' | translate }}</label>
                <select id="statusFilter" (change)="onStatusFilterChange($event)" class="block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-white">
                    <option value="" [selected]="statusFilter() === ''">{{ 'filter.allStatuses' | translate }}</option>
                    @for(status of jigStatuses; track status) {
                        <option [value]="status" [selected]="statusFilter() === status">{{ getStatusTranslationKey(status) | translate }}</option>
                    }
                </select>
            </div>
            
            <!-- Search Input -->
            <div class="flex-1 min-w-[200px]">
                <label for="search" class="block text-sm font-medium text-gray-700 mb-1">{{ 'filter.searchLabel' | translate }}</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                        <i class="fas fa-search text-gray-400"></i>
                    </span>
                    <input
                        id="search"
                        type="text"
                        [value]="filter()"
                        (input)="onFilterChange($event)"
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                        [placeholder]="'header.searchPlaceholder' | translate"
                    />
                </div>
            </div>
          </div>
        }
      </div>
    </header>

    <!-- Content area -->
    <div class="flex-1 overflow-y-auto bg-gray-50">
      <div class="p-4 md:p-6">
        @switch (currentView()) {
          @case ('inventory') {
            <app-jig-inventory 
              [jigs]="jigs()" 
              [userRole]="currentUser()?.role"
              (viewJig)="handleViewJig($event)"
              (deleteJig)="handleDeleteJig($event)">
            </app-jig-inventory>
          }
          @case ('detail') {
            @if (selectedJig()) {
              <app-jig-detail 
                  [jig]="selectedJig()!" 
                  (logMaintenance)="handleLogMaintenance($event)" 
                  (changeStatus)="handleChangeStatus($event)"
                  (close)="currentView.set('inventory')">
              </app-jig-detail>
            }
          }
          @case ('newJig') {
            <app-jig-form (save)="handleSaveJig($event)" (cancel)="handleCancel()"></app-jig-form>
          }
          @case ('maintenance') {
            @if (selectedJig()) {
              <app-maintenance-form [jig]="selectedJig()!" (save)="handleSaveMaintenance($event)" (cancel)="handleCancel()"></app-maintenance-form>
            }
          }
        }
      </div>
    </div>
  </main>
</div>
} @else {
  <app-login></app-login>
}